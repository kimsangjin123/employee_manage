<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="employee">
    
    <resultMap type="com.spring.board.vo.EmployeeVo" id="EmployeeVo">
    <result property="employeeId" column="EMPLOYEE_ID"/>
    <result property="employeeName" column="EMPLOYEE_NAME"/>
    <result property="ssNumber1" column="SS_NUMBER1"/>
    <result property="ssNumber2" column="SS_NUMBER2"/>
    
    
    <result property="department" column="DEPARTMENT"/>
     <result property="employeeJob" column="EMPLOYEE_JOB"/>
    <result property="startDate" column="START_DATE"/>
    <result property="regiDate" column="REGI_DATE"/>
    <result property="sal" column="SAL"/>
    <result property="workType" column="WORK_TYPE"/>
    <result property="workDays" column="WORK_DAYS"/>
    <result property="endDate" column="END_DATE"/>
    <result property="employeeAddr1" column="EMPLOYEE_ADDR1"/>
    <result property="employeeAddr2" column="EMPLOYEE_ADDR2"/>
    <result property="employeeAddr3" column="EMPLOYEE_ADDR3"/>
    <result property="employeeAddr4" column="EMPLOYEE_ADDR4"/>
    <result property="employeeAddr5" column="EMPLOYEE_ADDR5"/>
	<collection property="employeeCodeVo" resultMap="EmployeeCodeVo"/>
    </resultMap>
	
	<resultMap type="com.spring.board.vo.EmployeeCodeVo" id="EmployeeCodeVo">
	
	<result property="codeType" column="CODE_TYPE"/>
	<result property="codeName" column="CODE_NAME"/>
	<result property="codeId" column="CODE_ID"/>
	
	</resultMap>

<insert id="insert" parameterType="com.spring.board.vo.EmployeeVo">
  /*employee.insert*/ 
        INSERT INTO 
        	EMPLOYEE
	    (
	    	EMPLOYEE_ID
	        ,EMPLOYEE_NAME
	        ,SS_NUMBER1
	        ,SS_NUMBER2
	        ,DEPARTMENT
	        ,EMPLOYEE_JOB
	        ,START_DATE
	        ,REGI_DATE
	        ,SAL
	        ,WORK_TYPE
	        ,EMPLOYEE_ADDR1
	        ,EMPLOYEE_ADDR2
	        ,EMPLOYEE_ADDR3
	        ,EMPLOYEE_ADDR4
	        ,EMPLOYEE_ADDR5
        )
        VALUES
        (
	        (SELECT TO_NUMBER(NVL(MAX(EMPLOYEE_ID),1)) FROM EMPLOYEE)+1
	        ,#{employeeName}
	        ,#{ssNumber1}
	        ,#{ssNumber2}
	        ,#{department}
	        ,#{employeeJob}
	        ,TO_DATE(#{startDate},'YY-MM-DD')
	        ,NULL
	        ,NULL
	        ,#{workType}
	        ,NVL(#{employeeAddr1},NULL)
	        ,NVL(#{employeeAddr2},NULL)
	        ,NVL(#{employeeAddr3},NULL)
	        ,NVL(#{employeeAddr4},NULL)
	        ,NVL(#{employeeAddr5},NULL)
        )

</insert>  
<select id="employeeList" parameterType="com.spring.board.vo.EmployeePageVo" resultMap="EmployeeVo">
	/* employee.employeeList */ 
	SELECT
		A.EMPLOYEE_ID
		,A.EMPLOYEE_NAME
		,B.CODE_NAME AS DEPARTMENT
		,C.CODE_NAME AS EMPLOYEE_JOB
	FROM
		(
		SELECT
			EMPLOYEE_ID
			,EMPLOYEE_NAME
			,EMPLOYEE_JOB
			,DEPARTMENT
			,ROW_NUMBER() OVER(ORDER BY EMPLOYEE_ID DESC) AS NUMROW
		FROM
			EMPLOYEE
		) A
		,(
			SELECT
				CODE_ID
				,CODE_NAME
			FROM
				EMPLOYEE_CODE
			WHERE
				CODE_TYPE='department'
						
		) B
		,(
			SELECT
				CODE_ID
				,CODE_NAME
			FROM
				EMPLOYEE_CODE
			WHERE
				CODE_TYPE='job'	
		) C
		
			
	WHERE
		A.DEPARTMENT=B.CODE_ID
	AND
		A.EMPLOYEE_JOB=C.CODE_ID
	AND
		A.NUMROW BETWEEN (#{pageNo}-1)*10+1 AND (#{pageNo})*10


</select>
<select id="selectEmployeeCnt" resultType="Integer">
	/* employee.selectEmployeeCnt */
	SELECT
		COUNT(*)
	FROM
		EMPLOYEE
</select>

<select id="employeeSelectOne" parameterType="com.spring.board.vo.EmployeeVo" resultMap="EmployeeVo">
	/*employee.employeeSelectOne*/

	SELECT
		 A.EMPLOYEE_ID
		 ,A.EMPLOYEE_NAME
		 ,B.CODE_NAME AS DEPARTMENT
		 ,C.CODE_NAME AS EMPLOYEE_JOB
		 ,D.CODE_NAME AS WORK_TYPE
		 ,TO_CHAR(A.START_DATE,'YYYY-MM-DD') AS START_DATE
		 ,TO_CHAR(A.REGI_DATE,'YYYY-MM-DD') AS REGI_DATE
		 ,A.SS_NUMBER1
		 ,A.SS_NUMBER2
		 ,TO_CHAR(NVL(A.REGI_DATE - A.START_DATE,CEIL(SYSDATE-A.START_DATE))) AS WORK_DAYS
		 ,TO_CHAR(NVL(A.REGI_DATE,SYSDATE),'YYYY-MM-DD') AS END_DATE
		 ,A.EMPLOYEE_ADDR1
		 ,A.EMPLOYEE_ADDR2
		 ,A.EMPLOYEE_ADDR3
		 ,A.EMPLOYEE_ADDR4
		 ,A.EMPLOYEE_ADDR5
		 
	FROM
		EMPLOYEE A
		,(
			SELECT
				CODE_ID
				,CODE_NAME
			FROM
				EMPLOYEE_CODE
			WHERE
				CODE_TYPE='department'
		) B
		,(
			SELECT
				CODE_ID
				,CODE_NAME
			FROM
				EMPLOYEE_CODE
			WHERE
				CODE_TYPE='job'
		) C
		,(
			SELECT
				CODE_ID
				,CODE_NAME
			FROM
				EMPLOYEE_CODE
			WHERE
				CODE_TYPE='worktype'
		) D

		
	WHERE
		A.DEPARTMENT=B.CODE_ID
	AND
		A.EMPLOYEE_JOB=C.CODE_ID
	AND
		A.WORK_TYPE=D.CODE_ID	
	AND
		A.EMPLOYEE_ID=#{employeeId}

	
</select>

<update id="employeeUpdate" parameterType="com.spring.board.vo.EmployeeVo">
	/* employee.employeeUpdate */
	UPDATE
		EMPLOYEE
	SET
		EMPLOYEE_NAME=#{employeeName}
		,DEPARTMENT=#{department}
		,SS_NUMBER1=#{ssNumber1}
		,SS_NUMBER2=#{ssNumber2}
		,EMPLOYEE_JOB=#{employeeJob}
		,START_DATE=#{startDate}
		,REGI_DATE=NVL(#{regiDate},NULL)
		,WORK_TYPE=#{workType}
		,EMPLOYEE_ADDR1=NVL(#{employeeAddr1},NULL)
		,EMPLOYEE_ADDR2=NVL(#{employeeAddr2},NULL)
		,EMPLOYEE_ADDR3=NVL(#{employeeAddr3},NULL)
		,EMPLOYEE_ADDR4=NVL(#{employeeAddr4},NULL)
		,EMPLOYEE_ADDR5=NVL(#{employeeAddr5},NULL)
	WHERE
		EMPLOYEE_ID=#{employeeId}

</update>

<delete id="employeeDelete" parameterType="com.spring.board.vo.EmployeeVo">
	/* employee.employeeDelete */
	DELETE
	FROM
		EMPLOYEE
	WHERE
		EMPLOYEE_ID=#{employeeId}

</delete>

<select id="employeeSelectCode" resultMap="EmployeeCodeVo">
	/*employee.employeeSelectCode*/
	SELECT
		CODE_TYPE
		,CODE_ID
		,CODE_NAME
	FROM
		EMPLOYEE_CODE
	ORDER BY
		CODE_ID

</select>


</mapper>
